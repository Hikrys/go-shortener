<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Go Shortener | 极简短链服务</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { font-family: 'Inter', sans-serif; background-color: #f3f4f6; }
        .fade-in { animation: fadeIn 0.5s ease-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body class="flex items-center justify-center h-screen">

<div class="bg-white p-10 rounded-2xl shadow-xl w-full max-w-lg text-center fade-in">
    <!-- Logo / 标题 -->
    <div class="mb-8">
        <h1 class="text-3xl font-bold text-gray-800 tracking-tight">Go Shortener</h1>
        <p class="text-gray-500 mt-2 text-sm">高效、稳定、安全的短链接生成服务</p>
    </div>

    <!-- 输入区域 -->
    <div class="relative">
        <input type="text" id="longUrl" placeholder="在此粘贴您的长链接 (例如: https://example.com)"
               class="w-full px-5 py-4 border border-gray-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all shadow-sm text-gray-700 bg-gray-50 placeholder-gray-400">

        <!-- 转换按钮 -->
        <button onclick="convert()"
                class="w-full mt-4 bg-blue-600 hover:bg-blue-700 text-white font-semibold py-3 px-6 rounded-xl transition duration-300 shadow-md transform hover:-translate-y-0.5">
            生成短链接
        </button>
    </div>

    <!-- 结果展示区域 (默认隐藏) -->
    <div id="resultArea" class="hidden mt-8 p-4 bg-green-50 rounded-lg border border-green-100 fade-in">
        <p class="text-sm text-green-600 mb-1">生成成功！</p>
        <div class="flex items-center justify-between bg-white px-3 py-2 rounded-md border border-gray-200">
            <a id="shortUrl" href="#" target="_blank" class="text-blue-600 font-medium truncate hover:underline"></a>
            <button onclick="copyUrl()" class="ml-3 text-xs text-gray-500 hover:text-blue-600 focus:outline-none">复制</button>
        </div>
    </div>

    <!-- 错误提示 (默认隐藏) -->
    <div id="errorArea" class="hidden mt-6 text-sm text-red-500 bg-red-50 p-3 rounded-lg border border-red-100 fade-in"></div>

    <div class="mt-10 text-xs text-gray-400">
        Powered by Go-Zero & Redis
    </div>
</div>

<script>
    async function convert() {
        const input = document.getElementById('longUrl');
        const resultArea = document.getElementById('resultArea');
        const errorArea = document.getElementById('errorArea');
        const shortUrlLink = document.getElementById('shortUrl');

        // 重置状态
        resultArea.classList.add('hidden');
        errorArea.classList.add('hidden');

        const url = input.value.trim();
        if (!url) {
            showError("请输入长链接");
            return;
        }

        try {
            // 调用后端接口
            const response = await fetch('/convert', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ longUrl: url })
            });

            const data = await response.json();

            if (response.ok) {
                // 成功
                shortUrlLink.href = "http://" + data.shortUrl; // 假设后端返回不带协议头
                shortUrlLink.textContent = data.shortUrl;
                resultArea.classList.remove('hidden');
            } else {
                // 业务错误
                showError(data.msg || "生成失败，请检查链接格式");
            }
        } catch (err) {
            // 网络错误
            showError("网络请求失败，请稍后重试");
            console.error(err);
        }
    }

    function showError(msg) {
        const errorArea = document.getElementById('errorArea');
        errorArea.textContent = msg;
        errorArea.classList.remove('hidden');
    }

    function copyUrl() {
        const url = document.getElementById('shortUrl').textContent;
        navigator.clipboard.writeText(url).then(() => {
            alert('已复制到剪贴板');
        });
    }
</script>
</body>
</html>